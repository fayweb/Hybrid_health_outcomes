significant_results <- tidy_data %>%
dplyr::filter(p.value < 0.05) %>%
dplyr::select(model, term, estimate, p.value) %>%
mutate(
estimate = round(estimate, 2),
p.value = case_when(
p.value < 0.001 ~ "< 0.001",
p.value < 0.01 ~ paste("=", round(p.value, 3)),
TRUE ~ paste("=", round(p.value, 2))
)
) %>%
rename(Gene = model, Species = term, Estimate = estimate, `P-value` = p.value) %>%
arrange(Gene, Species)
return(significant_results)
}
# Create simplified tables
lab_simple <- create_simplified_table(lab_analysis$tidy_results, "Laboratory")
field_simple <- create_simplified_table(field_analysis$tidy_results, "Field")
lab_simple
field_simple
# Create publication-ready simplified tables
create_publication_simple_table <- function(simple_data, caption_text, filename) {
# Format the table
pub_table <- simple_data %>%
kbl(caption = caption_text,
format = "html",
digits = 2,
escape = FALSE) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE,
font_size = 12) %>%
column_spec(1, bold = TRUE) %>%
column_spec(2, italic = TRUE) %>%  # Italicize species names
column_spec(3, width = "2cm") %>%
column_spec(4, width = "2cm") %>%
add_header_above(c(" " = 2, "Regression Results" = 2))
# Save table
save_kable(pub_table, file = filename)
return(pub_table)
}
# Create the publication tables
lab_pub_simple <- create_publication_simple_table(
lab_simple,
"Table 1: Significant immune gene expression changes in laboratory-infected mice",
"output/tables/lab_genes_simple.html"
)
field_pub_simple <- create_publication_simple_table(
field_simple,
"Table 2: Significant immune gene expression changes in field-caught mice",
"output/tables/field_genes_simple.html"
)
# Print the tables
print(lab_pub_simple)
print(field_pub_simple)
# Optional: Create a combined table showing both lab and field side by side
combined_simple <- lab_simple %>%
rename(Lab_Estimate = Estimate, Lab_Pvalue = `P-value`) %>%
full_join(field_simple %>%
rename(Field_Estimate = Estimate, Field_Pvalue = `P-value`),
by = c("Gene", "Species")) %>%
arrange(Gene, Species)
# Optional: Create a combined table showing both lab and field side by side
combined_simple <- lab_simple %>%
rename(Lab_Estimate = Estimate, Lab_Pvalue = `P-value`) %>%
full_join(field_simple %>%
rename(Field_Estimate = Estimate, Field_Pvalue = `P-value`),
by = c("Gene", "Species")) %>%
arrange(Gene, Species)
combined_pub_table <- combined_simple %>%
kbl(caption = "Table 1: Comparison of significant immune gene responses between laboratory and field mice",
format = "html",
digits = 2,
escape = FALSE,
col.names = c("Gene", "Species", "Estimate", "P-value", "Estimate", "P-value")) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE) %>%
column_spec(1, bold = TRUE) %>%
column_spec(2, italic = TRUE) %>%
add_header_above(c(" " = 2, "Laboratory" = 2, "Field" = 2))
print(combined_pub_table)
# Convert to GT table
combined_gt_table <- combined_simple %>%
gt() %>%
# Add title and subtitle
tab_header(
title = "Table 1: Comparison of significant immune gene responses",
subtitle = "Laboratory vs. field-caught mice infected with Eimeria spp."
) %>%
# Format column headers
cols_label(
Gene = "Gene",
Species = "Species",
Lab_Estimate = "Estimate",
Lab_Pvalue = "P-value",
Field_Estimate = "Estimate",
Field_Pvalue = "P-value"
) %>%
# Add column spanners
tab_spanner(
label = "Laboratory",
columns = c(Lab_Estimate, Lab_Pvalue)
) %>%
tab_spanner(
label = "Field",
columns = c(Field_Estimate, Field_Pvalue)
) %>%
# Style the table
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(columns = Gene)
) %>%
tab_style(
style = cell_text(style = "italic"),
locations = cells_body(columns = Species)
) %>%
# Format numbers
fmt_number(
columns = c(Lab_Estimate, Field_Estimate),
decimals = 2
) %>%
# Handle missing values
sub_missing(
columns = everything(),
missing_text = "—"
) %>%
# Add source note
tab_source_note(
source_note = "Only genes with p < 0.05 in at least one condition shown. Full results in Supplementary Tables S1-S2."
) %>%
# Style the table
tab_options(
table.font.size = 12,
data_row.padding = px(3),
summary_row.padding = px(3),
grand_summary_row.padding = px(3),
footnotes.padding = px(3),
source_notes.padding = px(3),
row_group.padding = px(3)
)
# Print the table
print(combined_gt_table)
# Convert to GT table
combined_gt_table <- combined_simple %>%
gt() %>%
# Add title and subtitle
tab_header(
title = "Comparison of significant immune gene responses",
subtitle = "Laboratory vs. field-caught mice infected with Eimeria spp."
) %>%
# Format column headers
cols_label(
Gene = "Gene",
Species = "Species",
Lab_Estimate = "Estimate",
Lab_Pvalue = "P-value",
Field_Estimate = "Estimate",
Field_Pvalue = "P-value"
) %>%
# Add column spanners
tab_spanner(
label = "Laboratory",
columns = c(Lab_Estimate, Lab_Pvalue)
) %>%
tab_spanner(
label = "Field",
columns = c(Field_Estimate, Field_Pvalue)
) %>%
# Style the table
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(columns = Gene)
) %>%
tab_style(
style = cell_text(style = "italic"),
locations = cells_body(columns = Species)
) %>%
# Format numbers
fmt_number(
columns = c(Lab_Estimate, Field_Estimate),
decimals = 2
) %>%
# Handle missing values
sub_missing(
columns = everything(),
missing_text = "—"
) %>%
# Add source note
tab_source_note(
source_note = "Only genes with p < 0.05 in at least one condition shown. Full results in Supplementary Tables S1-S2."
) %>%
# Style the table
tab_options(
table.font.size = 12,
data_row.padding = px(3),
summary_row.padding = px(3),
grand_summary_row.padding = px(3),
footnotes.padding = px(3),
source_notes.padding = px(3),
row_group.padding = px(3)
)
# Print the table
print(combined_gt_table)
# Save using your function
save_table_all_formats(combined_gt_table, "gene_responses_combined_gt", "output/tables")
# Convert to GT table
combined_gt_table <- combined_simple %>%
gt() %>%
# Add title and subtitle
tab_header(
title = "Table 1: Comparison of significant immune gene responses",
subtitle = "Controlled laboratory infections vs. field-caught mice infected with Eimeria spp."
) %>%
# Format column headers
cols_label(
Gene = "Gene",
Species = "Species",
Lab_Estimate = "Estimate",
Lab_Pvalue = "P-value",
Field_Estimate = "Estimate",
Field_Pvalue = "P-value"
) %>%
# Add column spanners
tab_spanner(
label = "Controlled laboratory infections",
columns = c(Lab_Estimate, Lab_Pvalue)
) %>%
tab_spanner(
label = "Field-caught mice",
columns = c(Field_Estimate, Field_Pvalue)
) %>%
# Style the table
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(columns = Gene)
) %>%
tab_style(
style = cell_text(style = "italic"),
locations = cells_body(columns = Species)
) %>%
# Format numbers
fmt_number(
columns = c(Lab_Estimate, Field_Estimate),
decimals = 2
) %>%
# Handle missing values
sub_missing(
columns = everything(),
missing_text = "—"
) %>%
# Add source note with italicized Eimeria
tab_source_note(
source_note = md("Only genes with p < 0.05 in at least one condition shown. Full results in Supplementary Tables S1-S2. Infections with *Eimeria* spp.")
) %>%
# Style the table
tab_options(
table.font.size = 12,
data_row.padding = px(3),
summary_row.padding = px(3),
grand_summary_row.padding = px(3),
footnotes.padding = px(3),
source_notes.padding = px(3),
row_group.padding = px(3)
)
# If you want to also italicize Eimeria in the subtitle:
combined_gt_table <- combined_gt_table %>%
tab_header(
title = "Table 1: Comparison of significant immune gene responses",
subtitle = md("Controlled laboratory infections vs. field-caught mice infected with *Eimeria* spp.")
)
# Print the table
print(combined_gt_table)
# Save using your function
save_table_all_formats(combined_gt_table, "gene_responses_combined_gt", "output/tables")
# Convert to GT table
combined_gt_table <- combined_simple %>%
gt() %>%
# Add title and subtitle
tab_header(
title = "Comparison of significant immune gene responses",
subtitle = "Controlled laboratory infections vs. field-caught mice infected with Eimeria spp."
) %>%
# Format column headers
cols_label(
Gene = "Gene",
Species = "Species",
Lab_Estimate = "Estimate",
Lab_Pvalue = "P-value",
Field_Estimate = "Estimate",
Field_Pvalue = "P-value"
) %>%
# Add column spanners
tab_spanner(
label = "Controlled laboratory infections",
columns = c(Lab_Estimate, Lab_Pvalue)
) %>%
tab_spanner(
label = "Field-caught mice",
columns = c(Field_Estimate, Field_Pvalue)
) %>%
# Style the table
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(columns = Gene)
) %>%
tab_style(
style = cell_text(style = "italic"),
locations = cells_body(columns = Species)
) %>%
# Format numbers
fmt_number(
columns = c(Lab_Estimate, Field_Estimate),
decimals = 2
) %>%
# Handle missing values
sub_missing(
columns = everything(),
missing_text = "—"
) %>%
# Add source note with italicized Eimeria
tab_source_note(
source_note = md("Only genes with p < 0.05 in at least one condition shown. Full results in Supplementary Tables S1-S2. Infections with *Eimeria* spp.")
) %>%
# Style the table
tab_options(
table.font.size = 12,
data_row.padding = px(3),
summary_row.padding = px(3),
grand_summary_row.padding = px(3),
footnotes.padding = px(3),
source_notes.padding = px(3),
row_group.padding = px(3)
)
# If you want to also italicize Eimeria in the subtitle:
combined_gt_table <- combined_gt_table %>%
tab_header(
title = "Table 1: Comparison of significant immune gene responses",
subtitle = md("Controlled laboratory infections vs. field-caught mice infected with *Eimeria* spp.")
)
# Print the table
print(combined_gt_table)
# Save using your function
save_table_all_formats(combined_gt_table, "gene_responses_combined_gt", "output/tables")
# Modified function to save each table in its own folder
save_table_all_formats <- function(table_object, table_name, output_dir = paste0(tables)) {
# Create table-specific folder
table_folder <- file.path(output_dir, table_name)
dir.create(table_folder, recursive = TRUE, showWarnings = FALSE)
# Create base filename (now inside the table folder)
base_path <- file.path(table_folder, table_name)
# Save in all formats
tryCatch({
# HTML (best for Google Docs)
gtsave(table_object, paste0(base_path, ".html"))
cat("✓ Saved", table_name, "as HTML\n")
# Word document
gtsave(table_object, paste0(base_path, ".docx"))
cat("✓ Saved", table_name, "as DOCX\n")
# PNG (high quality image)
gtsave(table_object, paste0(base_path, ".png"),
vwidth = 1200, vheight = 800)
cat("✓ Saved", table_name, "as PNG\n")
# PDF (best for LaTeX)
gtsave(table_object, paste0(base_path, ".pdf"))
cat("✓ Saved", table_name, "as PDF\n")
# LaTeX code
table_object %>%
as_latex() %>%
writeLines(paste0(base_path, ".tex"))
cat("✓ Saved", table_name, "as TEX\n")
cat("✅ All formats saved in folder:", table_folder, "\n\n")
}, error = function(e) {
cat("❌ Error saving", table_name, ":", e$message, "\n")
})
}
# Convert to GT table
combined_gt_table <- combined_simple %>%
gt() %>%
# Add title and subtitle
tab_header(
title = "Comparison of significant immune gene responses",
subtitle = "Controlled laboratory infections vs. field-caught mice infected with Eimeria spp."
) %>%
# Format column headers
cols_label(
Gene = "Gene",
Species = "Species",
Lab_Estimate = "Estimate",
Lab_Pvalue = "P-value",
Field_Estimate = "Estimate",
Field_Pvalue = "P-value"
) %>%
# Add column spanners
tab_spanner(
label = "Controlled laboratory infections",
columns = c(Lab_Estimate, Lab_Pvalue)
) %>%
tab_spanner(
label = "Field-caught mice",
columns = c(Field_Estimate, Field_Pvalue)
) %>%
# Style the table
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(columns = Gene)
) %>%
tab_style(
style = cell_text(style = "italic"),
locations = cells_body(columns = Species)
) %>%
# Format numbers
fmt_number(
columns = c(Lab_Estimate, Field_Estimate),
decimals = 2
) %>%
# Handle missing values
sub_missing(
columns = everything(),
missing_text = "—"
) %>%
# Add source note with italicized Eimeria
tab_source_note(
source_note = md("Only genes with p < 0.05 in at least one condition shown. Full results in Supplementary Tables S1-S2. Infections with *Eimeria* spp.")
) %>%
# Style the table
tab_options(
table.font.size = 12,
data_row.padding = px(3),
summary_row.padding = px(3),
grand_summary_row.padding = px(3),
footnotes.padding = px(3),
source_notes.padding = px(3),
row_group.padding = px(3)
)
# If you want to also italicize Eimeria in the subtitle:
combined_gt_table <- combined_gt_table %>%
tab_header(
title = "Table 1: Comparison of significant immune gene responses",
subtitle = md("Controlled laboratory infections vs. field-caught mice infected with *Eimeria* spp.")
)
# Print the table
print(combined_gt_table)
# Save using your function
save_table_all_formats(combined_gt_table, "gene_responses_combined_gt", "output/tables")
# Convert to GT table
combined_gt_table <- combined_simple %>%
gt() %>%
# Add title and subtitle
tab_header(
title = "Comparison of significant immune gene responses",
subtitle = "Controlled laboratory infections vs. field-caught mice infected with Eimeria spp."
) %>%
# Format column headers
cols_label(
Gene = "Gene",
Species = "Species",
Lab_Estimate = "Estimate",
Lab_Pvalue = "P-value",
Field_Estimate = "Estimate",
Field_Pvalue = "P-value"
) %>%
# Add column spanners
tab_spanner(
label = "Controlled laboratory infections",
columns = c(Lab_Estimate, Lab_Pvalue)
) %>%
tab_spanner(
label = "Field-caught mice",
columns = c(Field_Estimate, Field_Pvalue)
) %>%
# Style the table
tab_style(
style = cell_text(weight = "bold"),
locations = cells_body(columns = Gene)
) %>%
tab_style(
style = cell_text(style = "italic"),
locations = cells_body(columns = Species)
) %>%
# Format numbers
fmt_number(
columns = c(Lab_Estimate, Field_Estimate),
decimals = 2
) %>%
# Handle missing values
sub_missing(
columns = everything(),
missing_text = "—"
) %>%
# Add source note with italicized Eimeria
tab_source_note(
source_note = md("Only genes with p < 0.05 in at least one condition shown. Full results in Supplementary Tables S1-S2. Infections with *Eimeria* spp.")
) %>%
# Style the table
tab_options(
table.font.size = 12,
data_row.padding = px(3),
summary_row.padding = px(3),
grand_summary_row.padding = px(3),
footnotes.padding = px(3),
source_notes.padding = px(3),
row_group.padding = px(3)
)
# If you want to also italicize Eimeria in the subtitle:
combined_gt_table <- combined_gt_table %>%
tab_header(
title = "Comparison of significant immune gene responses",
subtitle = md("Controlled laboratory infections vs. field-caught mice infected with *Eimeria* spp.")
)
# Print the table
print(combined_gt_table)
# Save using your function
save_table_all_formats(combined_gt_table, "gene_responses_combined_gt", "output/tables")
