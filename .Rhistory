legend.position = "none"))
######################
# Assuming combined_plot and plot_WL_mc_combined are your ggplot objects
# Combine the plots without any space between them and add labels only to the first row
map_plot <- (combined_plot | plot_WL_mc_combined) +
plot_layout(tag_level = 'new') +  # Collect all legends into a single legend
plot_annotation(tag_levels = list(c('A', 'B'), '1')))# +  # Add labels (A, B)
######################
# Assuming combined_plot and plot_WL_mc_combined are your ggplot objects
# Combine the plots without any space between them and add labels only to the first row
map_plot <- (combined_plot | plot_WL_mc_combined) +
plot_layout(tag_level = 'new') +  # Collect all legends into a single legend
plot_annotation(tag_levels = list(c('A', 'B'), '1'))# +  # Add labels (A, B)
# Add a figure title
map_plot <- map_plot +
plot_annotation(title = 'Fig. 8',
theme = theme(plot.title = element_text(size = 13, hjust = 0),
legend.position = "none"))
# Display the panel figure
print(map_plot)
######################
# Assuming combined_plot and plot_WL_mc_combined are your ggplot objects
# Combine the plots without any space between them and add labels only to the first row
map_plot <- (combined_plot | plot_WL_mc_combined) +
plot_layout(tag_level = 'new') +  #
plot_annotation(tag_levels = list(c('A'), 'B'))# +  # Add labels (A, B)
# Add a figure title
map_plot <- map_plot +
plot_annotation(title = 'Fig. 8',
theme = theme(plot.title = element_text(size = 13, hjust = 0),
legend.position = "none"))
# Display the panel figure
print(map_plot)
plot_annotation(tag_levels = list(c('A', 'B'))# +  # Add labels (A, B)
# Add a figure title
map_plot <- map_plot +
plot_annotation(tag_levels = list(c('A', 'B'))# +  # Add labels (A, B)
# Add a figure title
map_plot <- map_plot +
######################
# Assuming combined_plot and plot_WL_mc_combined are your ggplot objects
# Combine the plots without any space between them and add labels only to the first row
map_plot <- (combined_plot | plot_WL_mc_combined) +
plot_layout(tag_level = 'new') +  #
plot_annotation(tag_levels = list(c('A', 'B')))# +  # Add labels (A, B)
# Add a figure title
map_plot <- map_plot +
plot_annotation(title = 'Fig. 8',
theme = theme(plot.title = element_text(size = 13, hjust = 0),
legend.position = "none"))
# Display the panel figure
print(map_plot)
######################
# Assuming combined_plot and plot_WL_mc_combined are your ggplot objects
# Combine the plots without any space between them and add labels only to the first row
map_plot <- (combined_plot | plot_WL_mc_combined) +
plot_layout(tag_level = 'new') +  #
plot_annotation(tag_levels = list(c('A', '', 'B', '')))# +  # Add labels (A, B)
# Add a figure title
map_plot <- map_plot +
plot_annotation(title = 'Fig. 8',
theme = theme(plot.title = element_text(size = 13, hjust = 0),
legend.position = "none"))
# Display the panel figure
print(map_plot)
plot_WL_Sex
# Use patchwork to combine the plots without any space between them
combined_plot <- plot_WL_Sex / HIgradientBar +
plot_layout(heights = c(1, 0.1)) # Adjust the relative heights as needed
# Print the combined plot
combined_plot
plot_WL_mc
# Display the panel figure
print(map_plot)
# Save the plot
# Note: Corrected the paste0 function usage for filename specification
ggsave(plot = map_plot,
filename = paste0(panels_fi, "/banana_map_immune_signature.jpeg"),
width = 10,
height = 5,
dpi = 1000)
##################################################
############ Testing according to delta ct (not recommended, just validating)
Field_ct <-  Field %>%
drop_na(delta_ct_cewe_MminusE) %>%
dplyr::mutate(delta_infection =
case_when(delta_ct_cewe_MminusE < -5 ~ "uninfected",
delta_ct_cewe_MminusE > -5 ~ "infected"))
Field_ct$delta_infection <- as.factor(Field_ct$delta_infection)
##All
fitWL_ct<- parasiteLoad::analyse(data = Field_ct,
response = "predicted_WL",
model = "normal",
group = "delta_infection")
##################################################
############ Testing according to delta ct (not recommended, just validating)
Field_ct <-  Field %>%
drop_na(delta_ct_cewe_MminusE) %>%
dplyr::mutate(delta_infection =
case_when(delta_ct_cewe_MminusE < -5 ~ "uninfected",
delta_ct_cewe_MminusE > -5 ~ "infected"))
Field_ct$delta_infection <- as.factor(Field_ct$delta_infection)
##All
fitWL_ct<- parasiteLoad::analyse(data = Field_ct,
response = "predicted_WL",
model = "normal",
group = "delta_infection")
plot_WL_ct <-
bananaPlot(mod = fitWL_ct$H3,
data = Field_ct,
response = "predicted_WL",
group = "delta_infection",
cols = c("white", "white")) +
scale_fill_manual(values = c("indianred3","steelblue1"),
name = "qPCR values - Eimeria detection in Caecum") +
scale_color_manual(values = c("indianred3", "steelblue1"),
name = "qPCR values - Eimeria detection in Caecum") +
theme_bw() +
theme(legend.position = c(0.5, 0.05),
legend.direction = "horizontal",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
labs(y = "Predicted detrimental health impact,
Immune signature")
plot_WL_ct
# Create the combined plot with the gradient bar as the "axis"
combined_plot <-
plot_grid(plot_WL_ct ,
HIgradientBar,
nrow = 2,
rel_heights = c(1.3, 1/8),
align = "hv",
axis = "tb",
vjust = c(-1,2),
scale = 1)
ggsave(plot = combined_plot,
filename = paste0(an_fi, "/hybrid_infected_ct.jpeg"),
width = 6, height = 6, dpi = 1000)
##################### Eimeria oocysts
Field_ooc_eim <-  Field %>%
drop_na(OPG) %>%
dplyr::mutate(oocysts_present =
case_when(OPG > 0 ~ "TRUE",
OPG == 0 ~ "FALSE"))
Field_ooc_eim$oocysts_present <- as.factor(Field_ooc_eim$oocysts_present)
##All
fitWL_ooc<- parasiteLoad::analyse(data = Field_ooc_eim,
response = "predicted_WL",
model = "normal",
group = "oocysts_present")
plot_WL_ooc <-
bananaPlot(mod = fitWL_ooc$H3,
data = Field_ooc_eim,
response = "predicted_WL",
group = "oocysts_present",
cols = c("white", "white")) +
scale_fill_manual(values = c("steelblue1","indianred3"),
name = "Eimeria oocysts present") +
scale_color_manual(values = c("steelblue1", "indianred3"),
name = "Eimeria oocysts present") +
theme_bw() +
theme(legend.position = c(0.5, 0.05),
legend.direction = "horizontal",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
labs(y = "Predicted detrimental health impact,
Immune signature")
plot_WL_ooc
# Create the combined plot with the gradient bar as the "axis"
combined_plot_ooc <-
plot_grid(plot_WL_ooc ,
HIgradientBar,
nrow = 2,
rel_heights = c(1.3, 1/8),
align = "hv",
axis = "tb",
vjust = c(-1,2),
scale = 1)
# Display the combined plot
combined_plot_ooc
# Create the combined plot with the gradient bar as the "axis"
combined_plot_ooc <- plot_WL_ooc /
HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
combined_plot_ooc
combined_plot_ct <- plot_WL_ct /
HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
combined_plot_ct
ggsave(plot = combined_plot_ooc,
filename = paste0(an_fi, "/hybrid_eimeria_ooc.jpeg"),
width = 6, height = 6,
dpi = 1000)
###################### I will here try to test it with other parsite infection
## I use different ways to code the presence of absence with the parasite
# note that this doesn't use a quantification measure
####################################################
#####  crpyto ct
Field_crypto <- Field %>%
drop_na(ILWE_Crypto_Ct) %>%
mutate(crypto_infected_ct =
case_when(
ILWE_Crypto_Ct > 0 ~ "TRUE",
ILWE_Crypto_Ct == 0 ~ "FALSE",
ILWE_Crypto_Ct == NA ~ NA
))
Field_crypto <- Field_crypto %>%
drop_na(crypto_infected)
###################### I will here try to test it with other parsite infection
## I use different ways to code the presence of absence with the parasite
# note that this doesn't use a quantification measure
####################################################
#####  crpyto ct
Field_crypto <- Field %>%
drop_na(ILWE_Crypto_Ct) %>%
mutate(crypto_infected_ct =
case_when(
ILWE_Crypto_Ct > 0 ~ "TRUE",
ILWE_Crypto_Ct == 0 ~ "FALSE",
ILWE_Crypto_Ct == NA ~ NA
))
Field_crypto <- Field_crypto %>%
drop_na(crypto_infected)
###################### I will here try to test it with other parsite infection
## I use different ways to code the presence of absence with the parasite
# note that this doesn't use a quantification measure
####################################################
#####  crpyto ct
Field_crypto <- Field %>%
drop_na(ILWE_Crypto_Ct) %>%
mutate(crypto_infected_ct =
case_when(
ILWE_Crypto_Ct > 0 ~ "TRUE",
ILWE_Crypto_Ct == 0 ~ "FALSE",
ILWE_Crypto_Ct == NA ~ NA
))
Field_crypto$crypto_infected_ct
Field_crypto$crypto_infected
Field_crypto <- Field_crypto %>%
drop_na(crypto_infected_ct)
Field_crypto$crypto_infected_ct <- as.factor(Field_crypto$crypto_infected_ct)
fitWL_crypto_ct <- parasiteLoad::analyse(data = Field_crypto,
response = "predicted_WL",
model = "normal",
group = "crypto_infected_ct")
# plot it
plot_WL_crypto_ct <-
bananaPlot(mod = fitWL_crypto_ct$H3,
data = Field_crypto,
response = "predicted_WL",
group = "crypto_infected_ct",
cols = c("white", "white")) +
scale_fill_manual(values = c("steelblue1", "indianred3"),
name = "Cryptosporidum detected in qPCR") +
scale_color_manual(values = c("steelblue1", "indianred3"),
name = "Cryptosporidum detected in qPCR") +
theme_bw()  +
theme(legend.position = c(0.5, 0.05),
legend.direction = "horizontal",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
labs(y = "Predicted detrimental health impact,
Immune signature")
plot_WL_crypto_ct
# Create the combined plot with the gradient bar as the "axis"
plot_WL_crypto_Ct <-
combined_plot_ooc <- plot_WL_crypto_ct /
HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
plot_WL_crypto_ct
# Create the combined plot with the gradient bar as the "axis"
plot_WL_crypto_Ct <- plot_WL_crypto_ct /
HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
plot_WL_crypto_ct
plot_WL_crypto_ct
# Create the combined plot with the gradient bar as the "axis"
plot_WL_crypto_Ct <- plot_WL_crypto_ct /
HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Create the combined plot with the gradient bar as the "axis"
plot_WL_crypto_Ct <- plot_WL_crypto_ct / HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
plot_WL_crypto_ct
# Create the combined plot with the gradient bar as the "axis"
plot_WL_crypto_Ct <- plot_WL_crypto_ct /
HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
plot_WL_crypto_ct
ggsave(plot = plot_WL_crypto_Ct,
filename = paste0(an_fi, "/hybrid_crypto_qpcr.jpeg"),  width = 6, height = 6, dpi = 1000)
rm(Field_crypto, Field_ct, Field_mc, gamma_, normal_, weibull_)
################################################
##############
######Worms?
##################First aspiculuris
Field %>%
pivot_longer(cols = c("Trichuris_muris", "Mastophorus_muris",
"Catenotaenia_pusilla", "Heligmosomoides_polygurus",
"Heterakis_sp", "Aspiculuris_sp", "Syphacia_sp",
"Taenia_sp", "Hymenolepis_sp"), names_to = "Worms",
values_to = "Counts_worms") %>%
ggplot(aes(x = Worms, y = Counts_worms)) +
geom_violin()
#####  Aspiculuris_sp
wormy_field <- Field %>%
mutate(wormy_asp =
case_when(
Aspiculuris_sp > 0 ~ "TRUE",
Aspiculuris_sp == 0 ~ "FALSE",
Aspiculuris_sp == NA ~ NA
))
wormy_field <- wormy_field %>%
drop_na(wormy_asp)
wormy_field$wormy_asp <- as.factor(wormy_field$wormy_asp)
fitWL_worm <- parasiteLoad::analyse(data = wormy_field,
response = "predicted_WL",
model = "normal",
group = "wormy_asp")
# plot it
plot_WL_worms <-
bananaPlot(mod = fitWL_worm$H3,
data = wormy_field,
response = "predicted_WL",
group = "wormy_asp",
cols = c("white", "white")) +
scale_fill_manual(values = c("steelblue1", "indianred3"),
name = "Detected Aspiculuris") +
scale_color_manual(values = c("steelblue1", "indianred3"),
name = "Detected Aspiculuris") +
theme_bw()  +
theme(legend.position = c(0.5, 0.05),
legend.direction = "horizontal",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
labs(y = "Predicted detrimental health impact,
Immune signature")
plot_WL_worms
# Create the combined plot with the gradient bar as the "axis"
plot_WL_worms <- plot_WL_worms / HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
plot_WL_worms
ggsave(plot = plot_WL_worms,
filename = paste0(an_fi, "/hybrid_aspiculuris.jpeg"),  width = 6, height = 6,
dpi = 1000)
##############################################################
#####  Syphacia
wormy_field <- Field %>%
mutate(wormy_asp =
case_when(
Syphacia_sp > 0 ~ "TRUE",
Syphacia_sp == 0 ~ "FALSE",
Syphacia_sp == NA ~ NA
))
wormy_field <- wormy_field %>%
drop_na(wormy_asp)
wormy_field$wormy_asp <- as.factor(wormy_field$wormy_asp)
fitWL_worm <- parasiteLoad::analyse(data = wormy_field,
response = "predicted_WL",
model = "normal",
group = "wormy_asp")
# plot it
plot_WL_syphacia <-
bananaPlot(mod = fitWL_worm$H3,
data = wormy_field,
response = "predicted_WL",
group = "wormy_asp",
cols = c("white", "white")) +
scale_fill_manual(values = c("steelblue1", "indianred3"),
name = "Detected Syphacia") +
scale_color_manual(values = c("steelblue1", "indianred3"),
name = "Detected Syphacia") +
theme_bw()  +
theme(legend.position = c(0.5, 0.05),
legend.direction = "horizontal",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
labs(y = "Predicted detrimental health impact,
Immune signature")
plot_WL_syphacia
# Create the combined plot with the gradient bar as the "axis"
plot_WL_syphacia <-  plot_WL_syphacia / HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
plot_WL_syphacia
ggsave(plot = plot_WL_syphacia,
filename = paste0(an_fi, "/hybrid_syphacia.jpeg"),
width = 6, height = 6,
dpi = 1000)
##############  Trichuris
wormy_field <- Field %>%
mutate(wormy_asp =
case_when(
Trichuris_muris > 0 ~ "TRUE",
Trichuris_muris == 0 ~ "FALSE",
Trichuris_muris == NA ~ NA
))
wormy_field <- wormy_field %>%
drop_na(wormy_asp)
wormy_field$wormy_asp <- as.factor(wormy_field$wormy_asp)
fitWL_worm <- parasiteLoad::analyse(data = wormy_field,
response = "predicted_WL",
model = "normal",
group = "wormy_asp")
# plot it
plot_WL_trichuris <-
bananaPlot(mod = fitWL_worm$H3,
data = wormy_field,
response = "predicted_WL",
group = "wormy_asp",
cols = c("white", "white")) +
scale_fill_manual(values = c("steelblue1", "indianred3"),
name = "Detected Trichuris") +
scale_color_manual(values = c("steelblue1", "indianred3"),
name = "Detected Trichuris") +
theme_bw()  +
theme(legend.position = c(0.5, 0.05),
legend.direction = "horizontal",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
labs(y = "Predicted detrimental health impact,
Immune signature")
plot_WL_trichuris
# Create the combined plot with the gradient bar as the "axis"
plot_WL_trichuris <- plot_WL_trichuris / HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
plot_WL_trichuris
ggsave(plot = plot_WL_trichuris,
filename = paste0(an_fi, "/hybrid_trichuris.jpeg"),
width = 6, height = 6, dpi = 1000)
##############  Heterakis
wormy_field <- Field %>%
mutate(wormy_asp =
case_when(
Heterakis_sp > 0 ~ "TRUE",
Heterakis_sp == 0 ~ "FALSE",
Heterakis_sp == NA ~ NA
))
wormy_field <- wormy_field %>%
drop_na(wormy_asp)
wormy_field$wormy_asp <- as.factor(wormy_field$wormy_asp)
fitWL_worm <- parasiteLoad::analyse(data = wormy_field,
response = "predicted_WL",
model = "normal",
group = "wormy_asp")
# plot it
plot_WL_heterakis <-
bananaPlot(mod = fitWL_worm$H3,
data = wormy_field,
response = "predicted_WL",
group = "wormy_asp",
cols = c("white", "white")) +
scale_fill_manual(values = c("steelblue1", "indianred3"),
name = "Detected Heterakis") +
scale_color_manual(values = c("steelblue1", "indianred3"),
name = "Detected Heterakis") +
theme_bw()  +
theme(legend.position = c(0.5, 0.05),
legend.direction = "horizontal",
axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
labs(y = "Predicted detrimental health impact,
Immune signature")
plot_WL_heterakis
# Create the combined plot with the gradient bar as the "axis"
plot_WL_heterakis <- plot_WL_heterakis / HIgradientBar +
plot_layout(heights = c(1.3, 1/8))
# Display the combined plot
plot_WL_heterakis
ggsave(plot = plot_WL_heterakis,
filename = paste0(an_fi, "/hybrid_heterakis.jpeg"),
width = 6, height = 6, dpi = 1000)
infection_plots <-
plot_grid(plot_WL_mc_combined, combined_plot, combined_plot_ooc,
plot_WL_crypto_Ct, plot_WL_worms, plot_WL_syphacia, plot_WL_trichuris,
plot_WL_heterakis,
nrow = 4, align = c("hv"), labels = LETTERS[1:8])
infection_plots <-
cowplot::plot_grid(plot_WL_mc_combined, combined_plot, combined_plot_ooc,
plot_WL_crypto_Ct, plot_WL_worms, plot_WL_syphacia, plot_WL_trichuris,
plot_WL_heterakis,
nrow = 4, align = c("hv"), labels = LETTERS[1:8])
infection_plots
panels_fi
ggsave(infection_plots, filename = paste0(panels_fi, "/infection_panel.jpeg"),
width = 12, height = 24, dpi = 1000)
# 7.4: Here we test the hybrid impact on predicted weight loss and further test
# the effect of sex and infection status with Eimeria
# I have further tested to see if the presence of various parasites independent
# of eimeria have an impact on the predicted weight loss in combination with
# hybridicity
if (0) source(file.path(canalysis, "analysis_hybrid_impact_sex_infection.R"))
# 7.4: Here we test the hybrid impact on predicted weight loss and further test
# the effect of sex and infection status with Eimeria
# I have further tested to see if the presence of various parasites independent
# of eimeria have an impact on the predicted weight loss in combination with
# hybridicity
if (1) source(file.path(canalysis, "analysis_hybrid_impact_sex_infection.R"))
